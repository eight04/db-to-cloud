{"version":3,"file":"db-to-cloud.js","sources":["../node_modules/@eight04/read-write-lock/index.js","../lib/lock.js","../lib/util.js","../lib/db-to-cloud.js","../shim/empty.js","../node_modules/universal-base64/dist/browser.js","../lib/request.js","../lib/drive/github.js","../lib/drive/dropbox.js","../lib/drive/onedrive.js","../lib/drive/google.js","../shim/path.mjs","../lib/drive/webdav.js"],"sourcesContent":["function createLock({maxActiveReader = Infinity} = {}) {\r\n  let firstTask;\r\n  let lastTask;\r\n  let activeReader = 0;\r\n  const self = {\r\n    read: fn => que(fn, false),\r\n    write: fn => que(fn, true),\r\n    length: 0\r\n  };\r\n  return self;\r\n  \r\n  function que(fn, block) {\r\n    const task = createTask({fn, block});\r\n    if (!lastTask) {\r\n      firstTask = lastTask = task;\r\n    } else {\r\n      lastTask.next = task;\r\n      task.prev = lastTask;\r\n      lastTask = task;\r\n      if (!firstTask) {\r\n        firstTask = lastTask;\r\n      }\r\n    }\r\n    self.length++;\r\n    deque();\r\n    return task.q.promise;\r\n  }\r\n  \r\n  function defer() {\r\n    const o = {};\r\n    o.promise = new Promise((resolve, reject) => {\r\n      o.resolve = resolve;\r\n      o.reject = reject;\r\n    });\r\n    return o;\r\n  }\r\n  \r\n  function createTask({\r\n    fn,\r\n    block = false,\r\n    prev,\r\n    next,\r\n    q = defer(),\r\n    q2 = fn.length ? defer() : null\r\n  }) {\r\n    return {fn, block, prev, next, q, q2};\r\n  }\r\n  \r\n  function deque() {\r\n    const task = firstTask;\r\n    if (\r\n      !task ||\r\n      task.block && task.prev ||\r\n      task.prev && task.prev.block ||\r\n      activeReader >= maxActiveReader\r\n    ) {\r\n      return;\r\n    }\r\n    if (!task.block) {\r\n      activeReader++;\r\n    }\r\n    firstTask = task.next;\r\n    let result;\r\n    try {\r\n      result = task.fn(task.q2 && task.q2.resolve);\r\n    } catch (err) {\r\n      task.q.reject(err);\r\n      // auto release with sync error\r\n      // q2 is useless in this case\r\n      onDone();\r\n      return;\r\n    }\r\n    if (task.q2) {\r\n      task.q2.promise.then(_onDone);\r\n    }\r\n    if (result && result.then) {\r\n      const pending = result.then(task.q.resolve, task.q.reject);\r\n      if (!task.q2) {\r\n        pending.then(onDone);\r\n      }\r\n    } else {\r\n      task.q.resolve(result);\r\n      if (!task.q2) {\r\n        // it's a sync function and you don't want to release it manually, why\r\n        // do you need a lock?\r\n        onDone();\r\n        return;\r\n      }\r\n    }\r\n    deque();\r\n    \r\n    function onDone() {\r\n      _onDone();\r\n    }\r\n    \r\n    function _onDone(afterDone) {\r\n      if (task.prev) {\r\n        task.prev.next = task.next;\r\n      }\r\n      if (task.next) {\r\n        task.next.prev = task.prev;\r\n      }\r\n      if (lastTask === task) {\r\n        lastTask = task.prev;\r\n      }\r\n      if (!task.block) {\r\n        activeReader--;\r\n      }\r\n      self.length--;\r\n      if (afterDone) {\r\n        afterDone();\r\n      }\r\n      deque();\r\n    }\r\n  }\r\n}\r\n\r\nfunction createLockPool(options) {\r\n  const locks = new Map; // scope -> lock\r\n  return {\r\n    read: (scope, fn) => op(scope, fn, \"read\"),\r\n    write: (scope, fn) => op(scope, fn, \"write\"),\r\n    locks\r\n  };\r\n  \r\n  async function op(scopeIter, fn, opType) {\r\n    // FIXME: dead lock if there are duplicated scopes?\r\n    const scopes = [];\r\n    const acquiring = [];\r\n    for (const scope of scopeIter) {\r\n      let lock = locks.get(scope);\r\n      if (!lock) {\r\n        lock = createLock(options);\r\n        locks.set(scope, lock);\r\n      }\r\n      const o = {\r\n        lock,\r\n        scope,\r\n        relase: null\r\n      };\r\n      acquiring.push(lock[opType](release => {\r\n        o.release = release;\r\n      }));\r\n      scopes.push(o);\r\n    }\r\n    await Promise.all(acquiring);\r\n    let result;\r\n    try {\r\n      result = fn(fn.length && onDone);\r\n    } catch (err) {\r\n      onDone();\r\n      throw err;\r\n    }\r\n    if (result && result.then) {\r\n      if (!fn.length) {\r\n        result.then(onDone, onDone);\r\n      }\r\n      return await result;\r\n    }\r\n    if (!fn.length) {\r\n      onDone();\r\n    }\r\n    return result;\r\n    \r\n    function onDone() {\r\n      for (const scope of scopes) {\r\n        scope.release(() => {\r\n          if (!scope.lock.length) {\r\n            locks.delete(scope.scope);\r\n          }\r\n        });\r\n      }\r\n      scopes.length = 0;\r\n    }\r\n  }\r\n}\r\n\r\nmodule.exports = {\r\n  createLock,\r\n  createLockPool\r\n};\r\n","class LockError extends Error {\r\n  constructor(expire) {\r\n    super(`The database is locked. Will expire at ${new Date(expire).toLocaleString()}`);\r\n    this.expire = expire;\r\n    this.name = \"LockError\";\r\n    if (Error.captureStackTrace) {\r\n      Error.captureStackTrace(this, LockError);\r\n    }\r\n  }\r\n}\r\n\r\nmodule.exports = {LockError};\r\n","function debounced(fn) {\r\n  let timer = 0;\r\n  let q;\r\n  return () => {\r\n    if (timer) {\r\n      clearTimeout(timer);\r\n    }\r\n    timer = setTimeout(run);\r\n    if (!q) {\r\n      q = defer();\r\n    }\r\n    return q.promise;\r\n  };\r\n  \r\n  function run() {\r\n    Promise.resolve(fn())\r\n      .then(q.resolve, q.reject);\r\n    timer = 0;\r\n    q = null;\r\n  }\r\n  \r\n  function defer() {\r\n    const o = {};\r\n    o.promise = new Promise((resolve, reject) => {\r\n      o.resolve = resolve;\r\n      o.reject = reject;\r\n    });\r\n    return o;\r\n  }\r\n}\r\n\r\nfunction delay(time) {\r\n  return new Promise(resolve => setTimeout(resolve, time));\r\n}\r\n\r\nmodule.exports = {debounced, delay};\r\n","const {createLock} = require(\"@eight04/read-write-lock\");\r\nconst {LockError} = require(\"./lock\");\r\nconst {delay, debounced} = require(\"./util\");\r\n\r\nfunction buildDrive(_drive) {\r\n  const drive = Object.create(_drive);\r\n  drive.get = async path => JSON.parse(await _drive.get(path));\r\n  drive.put = async (path, data) => await _drive.put(path, JSON.stringify(data));\r\n  drive.post = async (path, data) => await _drive.post(path, JSON.stringify(data));\r\n  drive.isInit = false;\r\n  \r\n  if (!drive.acquireLock) {\r\n    drive.acquireLock = acquireLock;\r\n    drive.releaseLock = releaseLock;\r\n  }\r\n  \r\n  if (!drive.getMeta) {\r\n    drive.getMeta = getMeta;\r\n    drive.putMeta = putMeta;\r\n  }\r\n  \r\n  if (!drive.peekChanges) {\r\n    drive.peekChanges = peekChanges;\r\n  }\r\n  \r\n  return drive;\r\n  \r\n  async function acquireLock(expire) {\r\n    try {\r\n      await this.post(\"lock.json\", {expire: Date.now() + expire * 60 * 1000});\r\n    } catch (err) {\r\n      if (err.code !== \"EEXIST\") {\r\n        throw err;\r\n      }\r\n      const data = await this.get(\"lock.json\");\r\n      if (Date.now() > data.expire) {\r\n        // FIXME: this may delete a different lock created by other instances\r\n        await this.delete(\"lock.json\");\r\n        throw new Error(\"Found expired lock, please try again\");\r\n      }\r\n      throw new LockError(data.expire);\r\n    }\r\n  }\r\n  \r\n  async function releaseLock() {\r\n    await this.delete(\"lock.json\");\r\n  }\r\n  \r\n  async function getMeta() {\r\n    try {\r\n      return await this.get(\"meta.json\");\r\n    } catch (err) {\r\n      if (err.code === \"ENOENT\" || err.code === 404) {\r\n        return {};\r\n      }\r\n      throw err;\r\n    }\r\n  }\r\n  \r\n  async function putMeta(data) {\r\n    await this.put(\"meta.json\", data);\r\n  }\r\n  \r\n  async function peekChanges(oldMeta) {\r\n    const newMeta = await this.getMeta();\r\n    return newMeta.lastChange !== oldMeta.lastChange;\r\n  }\r\n}\r\n\r\nfunction dbToCloud({\r\n  onGet,\r\n  onPut,\r\n  onDelete,\r\n  onFirstSync,\r\n  onWarn = console.error,\r\n  onProgress,\r\n  compareRevision,\r\n  getState,\r\n  setState,\r\n  lockExpire = 60,\r\n  retryMaxAttempts = 5,\r\n  retryExp = 1.5,\r\n  retryDelay = 10\r\n}) {\r\n  let drive;\r\n  let state;\r\n  let meta;\r\n  const changeCache = new Map;\r\n  const saveState = debounced(() => setState(drive, state));\r\n  const revisionCache = new Map;\r\n  const lock = createLock();\r\n  return {\r\n    use,\r\n    init,\r\n    uninit,\r\n    put,\r\n    delete: delete_,\r\n    syncNow,\r\n    drive: () => drive,\r\n    isInit: () => Boolean(state && state.enabled)\r\n  };\r\n  \r\n  function use(newDrive) {\r\n    drive = buildDrive(newDrive);\r\n  }\r\n  \r\n  function init() {\r\n    return lock.write(async () => {\r\n      if (state && state.enabled) {\r\n        return;\r\n      }\r\n      if (!drive) {\r\n        throw new Error(\"cloud drive is undefined\");\r\n      }\r\n      \r\n      state = await getState(drive) || {};\r\n      state.enabled = true;\r\n      if (!state.queue) {\r\n        state.queue = [];\r\n      }\r\n    });\r\n  }\r\n  \r\n  function uninit() {\r\n    return lock.write(async () => {\r\n      if (!state || !state.enabled) {\r\n        return;\r\n      }\r\n      state = meta = null;\r\n      changeCache.clear();\r\n      revisionCache.clear();\r\n      if (drive.uninit && drive.isInit) {\r\n        await drive.uninit();\r\n        drive.isInit = false;\r\n      }\r\n      await saveState();\r\n    });\r\n  }\r\n  \r\n  async function syncPull() {\r\n    meta = await drive.getMeta();\r\n    if (!meta.lastChange || meta.lastChange === state.lastChange) {\r\n      // nothing changes\r\n      return;\r\n    }\r\n    let changes = [];\r\n    if (!state.lastChange) {\r\n      // pull everything\r\n      changes = (await drive.list(\"docs\"))\r\n        .map(name => ({action: 'put', _id: name.slice(0, -5)}));\r\n    } else {\r\n      const end = Math.floor((meta.lastChange - 1) / 100); // inclusive end\r\n      let i = Math.floor(state.lastChange / 100);\r\n      while (i <= end) {\r\n        const newChanges = await drive.get(`changes/${i}.json`);\r\n        changeCache.set(i, newChanges);\r\n        changes = changes.concat(newChanges);\r\n        i++;\r\n      }\r\n      changes = changes.slice(state.lastChange % 100);\r\n    }\r\n    // merge changes\r\n    const idx = new Map;\r\n    for (const change of changes) {\r\n      idx.set(change._id, change);\r\n    }\r\n    let loaded = 0;\r\n    for (const [id, change] of idx) {\r\n      let doc, _rev;\r\n      if (onProgress) {\r\n        onProgress({\r\n          phase: 'pull',\r\n          total: idx.size,\r\n          loaded,\r\n          change\r\n        });\r\n      }\r\n      if (change.action === \"delete\") {\r\n        await onDelete(id, change._rev);\r\n      } else if (change.action === \"put\") {\r\n        try {\r\n          ({doc, _rev} = await drive.get(`docs/${id}.json`));\r\n        } catch (err) {\r\n          if (err.code === \"ENOENT\" || err.code === 404) {\r\n            onWarn(`Cannot find ${id}. Is it deleted without updating the history?`);\r\n            loaded++;\r\n            continue;\r\n          }\r\n          throw err;\r\n        }\r\n        await onPut(doc);\r\n      }\r\n      // record the remote revision\r\n      const rev = change._rev || _rev;\r\n      if (rev) {\r\n        revisionCache.set(id, rev);\r\n      }\r\n      loaded++;\r\n    }\r\n    state.lastChange = meta.lastChange;\r\n    await saveState();\r\n  }\r\n  \r\n  async function syncPush() {\r\n    if (!state.queue.length) {\r\n      // nothing to push\r\n      return;\r\n    }\r\n    // snapshot\r\n    const changes = state.queue.slice();\r\n\r\n    // merge changes\r\n    const idx = new Map;\r\n    for (const change of changes) {\r\n      idx.set(change._id, change);\r\n    }\r\n    // drop outdated change\r\n    const newChanges = [];\r\n    for (const change of idx.values()) {\r\n      // FIXME: is it safe to assume that the local doc is newer when\r\n      // remoteRev is undefined?\r\n      const remoteRev = revisionCache.get(change._id);\r\n      if (remoteRev !== undefined && compareRevision(change._rev, remoteRev) <= 0) {\r\n        continue;\r\n      }\r\n      newChanges.push(change);\r\n    }\r\n    // FIXME: there should be no need to push data when !newChanges.length\r\n    \r\n    // start pushing\r\n    let loaded = 0;\r\n    for (const change of newChanges) {\r\n      if (onProgress) {\r\n        onProgress({\r\n          phase: 'push',\r\n          loaded,\r\n          total: newChanges.length,\r\n          change\r\n        });\r\n      }\r\n      if (change.action === \"delete\") {\r\n        await drive.delete(`docs/${change._id}.json`);\r\n      } else if (change.action === \"put\") {\r\n        const doc = await onGet(change._id, change._rev);\r\n        await drive.put(`docs/${change._id}.json`, {doc, _rev: change._rev});\r\n      }\r\n      revisionCache.set(change._id, change._rev);\r\n      loaded++;\r\n    }\r\n    \r\n    // push changes\r\n    let lastChanges;\r\n    let index;\r\n    // meta is already pulled in syncPull\r\n    if (meta.lastChange) {\r\n      index = Math.floor(meta.lastChange / 100);\r\n      const len = meta.lastChange % 100;\r\n      lastChanges = len ?\r\n        changeCache.get(index) || await drive.get(`changes/${index}.json`) :\r\n        [];\r\n      // it is possible that JSON data contains more records defined by\r\n      // meta.lastChange\r\n      lastChanges = lastChanges.slice(0, len).concat(newChanges);\r\n    } else {\r\n      // first sync\r\n      index = 0;\r\n      lastChanges = newChanges;\r\n    }\r\n    \r\n    for (let i = 0; i * 100 < lastChanges.length; i++) {\r\n      const window = lastChanges.slice(i * 100, (i + 1) * 100);\r\n      await drive.put(`changes/${index + i}.json`, window);\r\n      changeCache.set(index + i, window);\r\n    }\r\n    meta.lastChange = (meta.lastChange || 0) + newChanges.length;\r\n    await drive.putMeta(meta);\r\n    \r\n    state.queue = state.queue.slice(changes.length);\r\n    state.lastChange = meta.lastChange;\r\n    await saveState();\r\n  }\r\n  \r\n  async function sync() {\r\n    let tried = 0;\r\n    let wait = retryDelay;\r\n    let lastErr;\r\n    while (true) { // eslint-disable-line no-constant-condition\r\n      try {\r\n        await drive.acquireLock(lockExpire);\r\n        break;\r\n      } catch (err) {\r\n        if (err.name !== \"LockError\") {\r\n          throw err;\r\n        }\r\n        lastErr = err;\r\n      }\r\n      tried++;\r\n      if (tried >= retryMaxAttempts) {\r\n        throw lastErr;\r\n      }\r\n      await delay(wait * 1000);\r\n      wait *= retryExp;\r\n    }\r\n    try {\r\n      await syncPull();\r\n      await syncPush();\r\n    } finally {\r\n      await drive.releaseLock();\r\n    }\r\n  }\r\n  \r\n  function syncNow(peek) {\r\n    return lock.write(async () => {\r\n      if (!state || !state.enabled) {\r\n        throw new Error(\"Cannot sync now, the sync is not enabled\");\r\n      }\r\n      if (drive.init && !drive.isInit) {\r\n        await drive.init();\r\n        drive.isInit = true;\r\n      }\r\n      if (state.lastChange == null) {\r\n        await onFirstSync();\r\n      }\r\n      await _syncNow(peek);\r\n    });\r\n  }\r\n  \r\n  async function _syncNow(peek = true) {\r\n    if (onProgress) {\r\n      onProgress({\r\n        phase: 'start'\r\n      });\r\n    }\r\n    try {\r\n      if (!state.queue.length && peek && meta) {\r\n        const changed = await drive.peekChanges(meta);\r\n        if (!changed) {\r\n          return;\r\n        }\r\n      }\r\n      await sync();\r\n    } finally {\r\n      if (onProgress) {\r\n        onProgress({\r\n          phase: 'end'\r\n        });\r\n      }\r\n    }\r\n  }\r\n  \r\n  function put(_id, _rev) {\r\n    if (!state || !state.enabled) {\r\n      return;\r\n    }\r\n    state.queue.push({\r\n      _id, _rev, action: \"put\"\r\n    });\r\n    saveState();\r\n  }\r\n  \r\n  function delete_(_id, _rev) {\r\n    if (!state || !state.enabled) {\r\n      return;\r\n    }\r\n    state.queue.push({\r\n      _id, _rev, action: \"delete\"\r\n    });\r\n    saveState();\r\n  }\r\n}\r\n\r\nmodule.exports = {dbToCloud};\r\n","module.exports = () => {};\r\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nfunction percentToByte(p) {\n    return String.fromCharCode(parseInt(p.slice(1), 16));\n}\nfunction encode(str) {\n    return btoa(encodeURIComponent(str).replace(/%[0-9A-F]{2}/g, percentToByte));\n}\nexports.encode = encode;\nfunction byteToPercent(b) {\n    return `%${`00${b.charCodeAt(0).toString(16)}`.slice(-2)}`;\n}\nfunction decode(str) {\n    return decodeURIComponent(Array.from(atob(str), byteToPercent).join(\"\"));\n}\nexports.decode = decode;\n//# sourceMappingURL=browser.js.map","const {createLock} = require(\"@eight04/read-write-lock\");\r\nconst base64 = require(\"universal-base64\");\r\n\r\nconst {delay} = require(\"./util\");\r\n\r\nclass RequestError extends Error {\r\n  constructor(message, origin, code = origin && origin.status) {\r\n    super(message);\r\n    this.code = code;\r\n    this.origin = origin;\r\n    if (Error.captureStackTrace) {\r\n      Error.captureStackTrace(this, RequestError);\r\n    }\r\n  }\r\n}\r\n\r\nfunction createRequest({fetch, cooldown = 0, getAccessToken, username, password}) {\r\n  const lock = createLock();\r\n  const basicAuth = username || password ?\r\n    `Basic ${base64.encode(`${username}:${password}`)}` :\r\n    null;\r\n  return args => {\r\n    return lock.write(async done => {\r\n      try {\r\n        return await doRequest(args);\r\n      } finally {\r\n        if (!cooldown || !args.method || args.method === \"GET\") {\r\n          done();\r\n        } else {\r\n          setTimeout(done, cooldown);\r\n        }\r\n      }\r\n    });\r\n  };\r\n  \r\n  async function doRequest({\r\n    path,\r\n    contentType,\r\n    headers: _headers,\r\n    format,\r\n    raw = false,\r\n    ...args\r\n  }) {\r\n    const headers = {};\r\n    if (getAccessToken) {\r\n      headers[\"Authorization\"] = `Bearer ${await getAccessToken()}`;\r\n    }\r\n    if (basicAuth) {\r\n      headers[\"Authorization\"] = basicAuth;\r\n    }\r\n    if (contentType) {\r\n      headers[\"Content-Type\"] = contentType;\r\n    }\r\n    Object.assign(headers, _headers);\r\n    while (true) { // eslint-disable-line no-constant-condition\r\n      // console.log(\"req\", path, args, headers);\r\n      const res = await fetch(path, {\r\n        headers,\r\n        ...args\r\n      });\r\n      // console.log(\"res\", path, args, res.status, headers);\r\n      if (!res.ok) {\r\n        const retry = res.headers.get(\"Retry-After\");\r\n        if (retry) {\r\n          const time = Number(retry);\r\n          if (time) {\r\n            await delay(time * 1000);\r\n            continue;\r\n          }\r\n        }\r\n        const text = await res.text();\r\n        throw new RequestError(`failed to fetch [${res.status}]: ${text}`, res);\r\n      }\r\n      if (raw) {\r\n        return res;\r\n      }\r\n      if (format) {\r\n        return await res[format]();\r\n      }\r\n      const resContentType = res.headers.get(\"Content-Type\");\r\n      if (/application\\/json/.test(resContentType)) {\r\n        return await res.json();\r\n      }\r\n      return await res.text();\r\n    }\r\n  }\r\n}\r\n\r\nmodule.exports = {createRequest, RequestError};\r\n","/* global self */\r\nconst base64 = require(\"universal-base64\");\r\n\r\nconst {createRequest} = require(\"../request\");\r\n\r\nfunction createDrive({\r\n  userAgent = \"db-to-cloud\",\r\n  owner,\r\n  repo,\r\n  getAccessToken,\r\n  fetch = (typeof self !== \"undefined\" ? self : global).fetch\r\n}) {\r\n  const request = createRequest({fetch, getAccessToken, cooldown: 1000});\r\n  const shaCache = new Map;\r\n  return {\r\n    name: \"github\",\r\n    get,\r\n    put,\r\n    post,\r\n    delete: delete_,\r\n    list,\r\n    shaCache\r\n  };\r\n  \r\n  function requestAPI(args) {\r\n    if (!args.headers) {\r\n      args.headers = {};\r\n    }\r\n    if (!args.headers[\"User-Agent\"]) {\r\n      args.headers[\"User-Agent\"] = userAgent;\r\n    }\r\n    if (!args.headers[\"Accept\"]) {\r\n      args.headers[\"Accept\"] = \"application/vnd.github.v3+json\";\r\n    }\r\n    args.path = `https://api.github.com${args.path}`;\r\n    return request(args);\r\n  }\r\n  \r\n  async function list(file) {\r\n    // FIXME: This API has an upper limit of 1,000 files for a directory. If you need to retrieve more files, use the Git Trees API.\r\n    const result = await requestAPI({\r\n      path: `/repos/${owner}/${repo}/contents/${file}`\r\n    });\r\n    const names = [];\r\n    for (const item of result) {\r\n      names.push(item.name);\r\n      shaCache.set(item.path, item.sha);\r\n    }\r\n    return names;\r\n  }\r\n  \r\n  async function get(file) {\r\n    // FIXME: This API supports files up to 1 megabyte in size.\r\n    const result = await requestAPI({\r\n      path: `/repos/${owner}/${repo}/contents/${file}`\r\n    });\r\n    shaCache.set(result.path, result.sha);\r\n    return base64.decode(result.content);\r\n  }\r\n  \r\n  async function put(file, data, overwrite = true) {\r\n    const params = {\r\n      message: \"\",\r\n      content: base64.encode(data)\r\n    };\r\n    if (overwrite && shaCache.has(file)) {\r\n      params.sha = shaCache.get(file);\r\n    }\r\n    const args = {\r\n      method: \"PUT\",\r\n      path: `/repos/${owner}/${repo}/contents/${file}`,\r\n      contentType: \"application/json\",\r\n      body: JSON.stringify(params)\r\n    };\r\n    let retried = false;\r\n    let result;\r\n    while (!result) {\r\n      try {\r\n        result = await requestAPI(args);\r\n      } catch (err) {\r\n        if (err.code !== 422 || !err.message.includes(\"\\\\\\\"sha\\\\\\\" wasn't supplied\")) {\r\n          throw err;\r\n        }\r\n        if (!overwrite || retried) {\r\n          err.code = \"EEXIST\";\r\n          throw err;\r\n        }\r\n        await get(file);\r\n      }\r\n      retried = true;\r\n    }\r\n    shaCache.set(file, result.content.sha);\r\n  }\r\n  \r\n  function post(file, data) {\r\n    return put(file, data, false);\r\n  }\r\n  \r\n  async function delete_(file) {\r\n    try {\r\n      let sha = shaCache.get(file);\r\n      if (!sha) {\r\n        await get(file);\r\n        sha = shaCache.get(file);\r\n      }\r\n      await requestAPI({\r\n        method: \"DELETE\",\r\n        path: `/repos/${owner}/${repo}/contents/${file}`,\r\n        body: JSON.stringify({\r\n          message: \"\",\r\n          sha\r\n        })\r\n      });\r\n    } catch (err) {\r\n      if (err.code === 404) {\r\n        return;\r\n      }\r\n      // FIXME: do we have to handle 422 errors?\r\n      throw err;\r\n    }\r\n  }\r\n}\r\n\r\nmodule.exports = createDrive;\r\n","/* global self */\r\nconst {createRequest} = require(\"../request\");\r\n\r\nfunction createDrive({\r\n  getAccessToken,\r\n  fetch = (typeof self !== \"undefined\" ? self : global).fetch\r\n}) {\r\n  const request = createRequest({fetch, getAccessToken});\r\n  return {\r\n    name: \"dropbox\",\r\n    get,\r\n    put,\r\n    post,\r\n    delete: delete_,\r\n    list\r\n  };\r\n  \r\n  function requestRPC({path, body, ...args}) {\r\n    return request({\r\n      method: \"POST\",\r\n      path: `https://api.dropboxapi.com/2/${path}`,\r\n      contentType: \"application/json\",\r\n      body: JSON.stringify(body),\r\n      ...args\r\n    });\r\n  }\r\n  \r\n  async function list(file) {\r\n    const names = [];\r\n    let result = await requestRPC({\r\n      path: \"files/list_folder\",\r\n      body: {\r\n        path: `/${file}`\r\n      }\r\n    });\r\n    for (const entry of result.entries) {\r\n      names.push(entry.name);\r\n    }\r\n    if (!result.has_more) {\r\n      return names;\r\n    }\r\n    while (result.has_more) {\r\n      result = await requestRPC({\r\n        path: \"files/list_folder/continue\",\r\n        body: {\r\n          cursor: result.cursor\r\n        }\r\n      });\r\n      for (const entry of result.entries) {\r\n        names.push(entry.name);\r\n      }\r\n    }\r\n    return names;\r\n  }\r\n  \r\n  function stringifyParams(obj) {\r\n    const params = new URLSearchParams;\r\n    params.set(\"arg\", JSON.stringify(obj));\r\n    return params.toString();\r\n  }\r\n  \r\n  async function get(file) {\r\n    const params = {\r\n      path: `/${file}`\r\n    };\r\n    try {\r\n      return await request({\r\n        path: `https://content.dropboxapi.com/2/files/download?${stringifyParams(params)}`,\r\n        format: \"text\"\r\n      });\r\n    } catch (err) {\r\n      if (err.code === 409 && err.message.includes(\"not_found\")) {\r\n        err.code = \"ENOENT\";\r\n      }\r\n      throw err;\r\n    }\r\n  }\r\n  \r\n  async function put(file, data, mode = \"overwrite\") {\r\n    const params = {\r\n      path: `/${file}`,\r\n      mode,\r\n      autorename: false,\r\n      mute: true\r\n    };\r\n    await request({\r\n      path: `https://content.dropboxapi.com/2/files/upload?${stringifyParams(params)}`,\r\n      method: \"POST\",\r\n      contentType: \"application/octet-stream\",\r\n      body: data\r\n    });\r\n  }\r\n  \r\n  async function post(file, data) {\r\n    try {\r\n      return await put(file, data, \"add\");\r\n    } catch (err) {\r\n      if (err.code === 409 && err.message.includes(\"conflict\")) {\r\n        err.code = \"EEXIST\";\r\n      }\r\n      throw err;\r\n    }\r\n  }\r\n  \r\n  async function delete_(file) {\r\n    try {\r\n      await requestRPC({\r\n        path: \"files/delete_v2\",\r\n        body: {\r\n          path: `/${file}`\r\n        }\r\n      });\r\n    } catch (err) {\r\n      if (err.code === 409 && err.message.includes(\"not_found\")) {\r\n        return;\r\n      }\r\n      throw err;\r\n    }\r\n  }\r\n}\r\n\r\nmodule.exports = createDrive;\r\n","/* global self */\r\nconst {createRequest} = require(\"../request\");\r\n\r\nfunction createDrive({\r\n  getAccessToken,\r\n  fetch = (typeof self !== \"undefined\" ? self : global).fetch\r\n}) {\r\n  const request = createRequest({fetch, getAccessToken});\r\n  return {\r\n    name: \"onedrive\",\r\n    get,\r\n    put,\r\n    post,\r\n    delete: delete_,\r\n    list\r\n  };\r\n  \r\n  async function query(args) {\r\n    args.path = `https://graph.microsoft.com/v1.0/me/drive/special/approot${args.path}`;\r\n    return await request(args);\r\n  }\r\n  \r\n  async function list(file) {\r\n    if (file) {\r\n      file = `:/${file}:`;\r\n    }\r\n    let result = await query({\r\n      path: `${file}/children?select=name`\r\n    });\r\n    let files = result.value.map(i => i.name);\r\n    while (result[\"@odata.nextLink\"]) {\r\n      result = await request({\r\n        path: result[\"@odata.nextLink\"]\r\n      });\r\n      files = files.concat(result.value.map(i => i.name));\r\n    }\r\n    return files;\r\n  }\r\n  \r\n  async function get(file) {\r\n    return await query({\r\n      path: `:/${file}:/content`,\r\n      format: \"text\"\r\n    });\r\n  }\r\n  \r\n  async function put(file, data) {\r\n    await query({\r\n      method: \"PUT\",\r\n      path: `:/${file}:/content`,\r\n      headers: {\r\n        \"Content-Type\": \"text/plain\"\r\n      },\r\n      body: data\r\n    });\r\n  }\r\n  \r\n  async function post(file, data) {\r\n    try {\r\n      await query({\r\n        method: \"PUT\",\r\n        path: `:/${file}:/content?@microsoft.graph.conflictBehavior=fail`,\r\n        headers: {\r\n          \"Content-Type\": \"text/plain\"\r\n        },\r\n        body: data\r\n      });\r\n    } catch (err) {\r\n      if (err.code === 409 && err.message.includes(\"nameAlreadyExists\")) {\r\n        err.code = \"EEXIST\";\r\n      }\r\n      throw err;\r\n    }\r\n  }\r\n  \r\n  async function delete_(file) {\r\n    try {\r\n      await query({\r\n        method: \"DELETE\",\r\n        path: `:/${file}:`\r\n      });\r\n    } catch (err) {\r\n      if (err.code === 404) {\r\n        return;\r\n      }\r\n      throw err;\r\n    }\r\n  }\r\n}\r\n\r\nmodule.exports = createDrive;\r\n","/* global self */\r\nconst {createRequest, RequestError} = require(\"../request\");\r\nconst {LockError} = require(\"../lock\");\r\n\r\nfunction createDrive({\r\n  getAccessToken,\r\n  fetch = (typeof self !== \"undefined\" ? self : global).fetch,\r\n  FormData = (typeof self !== \"undefined\" ? self : global).FormData,\r\n  Blob = (typeof self !== \"undefined\" ? self : global).Blob\r\n}) {\r\n  const request = createRequest({fetch, getAccessToken});\r\n  const fileMetaCache = new Map;\r\n  let lockRev;\r\n  return {\r\n    name: \"google\",\r\n    get,\r\n    put,\r\n    post,\r\n    delete: delete_,\r\n    list,\r\n    init,\r\n    acquireLock,\r\n    releaseLock,\r\n    fileMetaCache\r\n  };\r\n  \r\n  async function revDelete(fileId, revId) {\r\n    await request({\r\n      method: \"DELETE\",\r\n      path: `https://www.googleapis.com/drive/v3/files/${fileId}/revisions/${revId}`\r\n    });\r\n  }\r\n  \r\n  async function acquireLock(expire) {\r\n    const lock = fileMetaCache.get(\"lock.json\");\r\n    const {headRevisionId} = await queryPatch(lock.id, JSON.stringify({expire: Date.now() + expire * 60 * 1000}));\r\n    const result = await request({\r\n      path: `https://www.googleapis.com/drive/v3/files/${lock.id}/revisions?fields=revisions(id)`\r\n    });\r\n    for (let i = 1; i < result.revisions.length; i++) {\r\n      const revId = result.revisions[i].id;\r\n      if (revId === headRevisionId) {\r\n        // success\r\n        lockRev = headRevisionId;\r\n        return;\r\n      }\r\n      const rev = JSON.parse(await request({\r\n        path: `https://www.googleapis.com/drive/v3/files/${lock.id}/revisions/${revId}?alt=media`\r\n      }));\r\n      if (rev.expire > Date.now()) {\r\n        // failed, delete the lock\r\n        await revDelete(lock.id, headRevisionId);\r\n        throw new LockError(rev.expire);\r\n      }\r\n      // delete outdated lock\r\n      await revDelete(lock.id, revId);\r\n    }\r\n    throw new Error(\"cannot find lock revision\");\r\n  }\r\n  \r\n  async function releaseLock() {\r\n    const lock = fileMetaCache.get(\"lock.json\");\r\n    await revDelete(lock.id, lockRev);\r\n    lockRev = null;\r\n  }\r\n  \r\n  async function queryList(path, onPage) {\r\n    path = \"https://www.googleapis.com/drive/v3/files?spaces=appDataFolder&fields=nextPageToken,files(id,name,headRevisionId)\" + (path ? \"&\" + path : \"\");\r\n    let result = await request({path});\r\n    onPage(result);\r\n    while (result.nextPageToken) {\r\n      result = await request({path: `${path}&pageToken=${result.nextPageToken}`});\r\n      onPage(result);\r\n    }\r\n  }\r\n  \r\n  async function queryPatch(id, text) {\r\n    return await request({\r\n      method: \"PATCH\",\r\n      path: `https://www.googleapis.com/upload/drive/v3/files/${id}?uploadType=media&fields=headRevisionId`,\r\n      headers: {\r\n        \"Content-Type\": \"text/plain\"\r\n      },\r\n      body: text\r\n    });\r\n  }\r\n  \r\n  async function updateMeta(query) {\r\n    if (query) {\r\n      query = `q=${encodeURIComponent(query)}`;\r\n    }\r\n    await queryList(query, result => {\r\n      for (const file of result.files) {\r\n        fileMetaCache.set(file.name, file);\r\n      }\r\n    });\r\n  }\r\n  \r\n  async function init() {\r\n    await updateMeta();\r\n    if (!fileMetaCache.has(\"lock.json\")) {\r\n      await post(\"lock.json\", \"{}\");\r\n    }\r\n    if (!fileMetaCache.has(\"meta.json\")) {\r\n      await post(\"meta.json\", \"{}\");\r\n    }\r\n  }\r\n  \r\n  async function list(file) {\r\n    // FIXME: this only works if file is a single dir\r\n    // FIXME: this only works if the list method is called right after init, use\r\n    // queryList instead?\r\n    return [...fileMetaCache.values()]\r\n      .filter(f => f.name.startsWith(file + \"/\"))\r\n      .map(f => f.name.split(\"/\")[1]);\r\n  }\r\n  \r\n  async function get(file) {\r\n    let meta = fileMetaCache.get(file);\r\n    if (!meta) {\r\n      await updateMeta(`name = '${file}'`);\r\n      meta = fileMetaCache.get(file);\r\n      if (!meta) {\r\n        throw new RequestError(`metaCache doesn't contain ${file}`, null, \"ENOENT\");\r\n      }\r\n    }\r\n    try {\r\n      return await request({\r\n        path: `https://www.googleapis.com/drive/v3/files/${meta.id}?alt=media`\r\n      });\r\n    } catch (err) {\r\n      if (err.code === 404) {\r\n        err.code = \"ENOENT\";\r\n      }\r\n      throw err;\r\n    }\r\n  }\r\n  \r\n  async function put(file, data) {\r\n    if (!fileMetaCache.has(file)) {\r\n      return await post(file, data);\r\n    }\r\n    const meta = fileMetaCache.get(file);\r\n    const result = await queryPatch(meta.id, data);\r\n    meta.headRevisionId = result.headRevisionId;\r\n  }\r\n  \r\n  async function post(file, data) {\r\n    const body = new FormData;\r\n    const meta = {\r\n      name: file,\r\n      parents: [\"appDataFolder\"]\r\n    };\r\n    body.append(\"metadata\", new Blob([JSON.stringify(meta)], {type: \"application/json; charset=UTF-8\"}));\r\n    body.append(\"media\", new Blob([data], {type: \"text/plain\"}));\r\n    const result = await request({\r\n      method: \"POST\",\r\n      path: \"https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id,name,headRevisionId\",\r\n      body\r\n    });\r\n    fileMetaCache.set(result.name, result);\r\n  }\r\n  \r\n  async function delete_(file) {\r\n    const meta = fileMetaCache.get(file);\r\n    if (!meta) {\r\n      return;\r\n    }\r\n    try {\r\n      await request({\r\n        method: \"DELETE\",\r\n        path: `https://www.googleapis.com/drive/v3/files/${meta.id}`\r\n      });\r\n    } catch (err) {\r\n      if (err.code === 404) {\r\n        return;\r\n      }\r\n      throw err;\r\n    }\r\n  }\r\n}\r\n\r\nmodule.exports = createDrive;\r\n","export function dirname(path) {\r\n  const dir = path.replace(/[/\\\\][^/\\\\]+\\/?$/, \"\");\r\n  if (dir === path) return \".\";\r\n  return dir;\r\n}\r\n","/* global self */\r\nconst {dirname} = require(\"path\");\r\n\r\nconst {createRequest} = require(\"../request\");\r\n\r\nfunction arrayify(o) {\r\n  return Array.isArray(o) ? o : [o];\r\n}\r\n\r\nfunction xmlToJSON(node) {\r\n  // FIXME: xmldom doesn't support children\r\n  const children = Array.prototype.filter.call(node.childNodes, i => i.nodeType === 1);\r\n  if (!children.length) {\r\n    return node.textContent;\r\n  }\r\n  \r\n  const o = {};\r\n  for (const c of children) {\r\n    const cResult = xmlToJSON(c);\r\n    if (!o[c.localName]) {\r\n      o[c.localName] = cResult;\r\n    } else if (!Array.isArray(o[c.localName])) {\r\n      const list = [o[c.localName]];\r\n      list.push(cResult);\r\n      o[c.localName] = list;\r\n    } else {\r\n      o[c.localName].push(cResult);\r\n    }\r\n  }\r\n  return o;\r\n}\r\n\r\nfunction createDrive({\r\n  username,\r\n  password,\r\n  url,\r\n  fetch = (typeof self !== \"undefined\" ? self : global).fetch,\r\n  DOMParser = (typeof self !== \"undefined\" ? self : global).DOMParser,\r\n}) {\r\n  if (!url.endsWith(\"/\")) {\r\n    url += \"/\";\r\n  }\r\n  let lockToken;\r\n  const request = createRequest({fetch, username, password});\r\n  return {\r\n    name: \"webdav\",\r\n    get,\r\n    put,\r\n    post,\r\n    delete: delete_,\r\n    list,\r\n    // acquireLock,\r\n    // releaseLock\r\n  };\r\n  \r\n  async function requestDAV({path, ...args}) {\r\n    if (lockToken) {\r\n      args.headers = args.headers || {};\r\n      args.headers[\"If\"] = `(${lockToken})`;\r\n    }\r\n    const text = await request({\r\n      path: `${url}${path}`,\r\n      ...args\r\n    });\r\n    if (args.format || typeof text !== \"string\" || !text) return text;\r\n    \r\n    const parser = new DOMParser;\r\n    const xml = parser.parseFromString(text, \"application/xml\");\r\n    const result = xmlToJSON(xml);\r\n    if (result.error) {\r\n      throw new Error(`Failed requesting DAV at ${url}${path}: ${JSON.stringify(result.error)}`);\r\n    }\r\n    if (result.multistatus) {\r\n      result.multistatus.response = arrayify(result.multistatus.response);\r\n      for (const r of result.multistatus.response) {\r\n        if (r.error) {\r\n          throw new Error(`Failed requesting DAV at ${url}${path}: ${r.href} ${r.error}`);\r\n        }\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n  \r\n  async function list(file) {\r\n    if (!file.endsWith(\"/\")) {\r\n      file += \"/\";\r\n    }\r\n    const result = await requestDAV({\r\n      method: \"PROPFIND\",\r\n      path: file,\r\n      contentType: \"application/xml\",\r\n      body: \r\n        `<?xml version=\"1.0\" encoding=\"utf-8\" ?> \r\n        <propfind xmlns=\"DAV:\">\r\n          <allprop/>\r\n        </propfind>`,\r\n      headers: {\r\n        \"Depth\": \"1\"\r\n      }\r\n    });\r\n    \r\n    const files = [];\r\n    for (const entry of arrayify(result.multistatus.response)) {\r\n      if (arrayify(entry.propstat).some(s => s.prop.resourcetype && s.prop.resourcetype.collection !== undefined)) {\r\n        continue;\r\n      }\r\n      const base = `${url}${file}`;\r\n      const absUrl = new URL(entry.href, base).href;\r\n      const name = absUrl.slice(base.length);\r\n      files.push(name);\r\n    }\r\n    return files;\r\n  }\r\n  \r\n  async function get(file) {\r\n    return await requestDAV({\r\n      method: \"GET\",\r\n      path: file,\r\n      format: \"text\"\r\n    });\r\n  }\r\n  \r\n  async function put(file, data) {\r\n    return await withDir(\r\n      dirname(file),\r\n      () => requestDAV({\r\n        method: \"PUT\",\r\n        path: file,\r\n        contentType: \"application/octet-stream\",\r\n        body: data\r\n      })\r\n    );\r\n  }\r\n  \r\n  async function withDir(dir, cb) {\r\n    try {\r\n      return await cb();\r\n    } catch (err) {\r\n      if (err.code !== 409 && err.code !== 404 || dir === \".\") {\r\n        throw err;\r\n      }\r\n    }\r\n    await withDir(dirname(dir), () =>\r\n      requestDAV({\r\n        method: \"MKCOL\",\r\n        path: dir\r\n      })\r\n    );\r\n    return await cb();\r\n  }\r\n  \r\n  async function post(file, data) {\r\n    try {\r\n      return await withDir(\r\n        dirname(file),\r\n        () => requestDAV({\r\n          method: \"PUT\",\r\n          path: file,\r\n          body: data,\r\n          contentType: \"octet-stream\",\r\n          headers: {\r\n            // FIXME: seems webdav-server doesn't support etag, what about others?\r\n            \"If-None-Match\": \"*\"\r\n          }\r\n        })\r\n      );\r\n    } catch (err) {\r\n      if (err.code === 412) {\r\n        err.code = \"EEXIST\";\r\n      }\r\n      throw err;\r\n    }\r\n  }\r\n  \r\n  async function delete_(file) {\r\n    // FIXME: support deleting collections?\r\n    // FIXME: handle errors?\r\n    try {\r\n      await requestDAV({\r\n        method: \"DELETE\",\r\n        path: file\r\n      });\r\n    } catch (err) {\r\n      if (err.code === 404) return;\r\n      throw err;\r\n    }\r\n  }\r\n  \r\n  // async function acquireLock(mins) {\r\n    // const r = await requestDAV({\r\n      // method: \"LOCK\",\r\n      // path: \"\",\r\n      // body: \r\n        // `<?xml version=\"1.0\" encoding=\"utf-8\" ?> \r\n        // <lockinfo xmlns='DAV:'> \r\n          // <lockscope><exclusive/></lockscope> \r\n          // <locktype><write/></locktype> \r\n        // </lockinfo> `,\r\n      // headers: {\r\n        // \"Timeout\": `Second-${mins * 60}`\r\n      // },\r\n      // raw: true\r\n    // });\r\n    // lockToken = r.headers.get(\"Lock-Token\");\r\n  // }\r\n  \r\n  // async function releaseLock() {\r\n    // await requestDAV({\r\n      // method: \"UNLOCK\",\r\n      // path: \"\",\r\n      // headers: {\r\n        // \"Lock-Token\": lockToken\r\n      // }\r\n    // });\r\n  // }\r\n}\r\n\r\nmodule.exports = createDrive;\r\n"],"names":["createLock","maxActiveReader","Infinity","firstTask","lastTask","activeReader","self","read","fn","que","write","length","block","task","createTask","next","prev","deque","q","promise","defer","o","Promise","resolve","reject","q2","result","err","onDone","then","_onDone","pending","afterDone","LockError","Error","constructor","expire","Date","toLocaleString","name","captureStackTrace","debounced","timer","clearTimeout","setTimeout","run","delay","time","buildDrive","_drive","drive","Object","create","get","path","JSON","parse","put","data","stringify","post","isInit","acquireLock","releaseLock","getMeta","putMeta","peekChanges","now","code","delete","oldMeta","newMeta","lastChange","dbToCloud","onGet","onPut","onDelete","onFirstSync","onWarn","console","error","onProgress","compareRevision","getState","setState","lockExpire","retryMaxAttempts","retryExp","retryDelay","state","meta","changeCache","Map","saveState","revisionCache","lock","use","init","uninit","delete_","syncNow","Boolean","enabled","newDrive","queue","clear","syncPull","changes","list","map","action","_id","slice","end","Math","floor","i","newChanges","set","concat","idx","change","loaded","id","doc","_rev","phase","total","size","rev","syncPush","values","remoteRev","undefined","push","lastChanges","index","len","window","sync","tried","wait","lastErr","peek","_syncNow","changed","RequestError","message","origin","status","createRequest","fetch","cooldown","getAccessToken","username","password","basicAuth","base64","args","done","doRequest","method","contentType","_headers","headers","format","raw","assign","res","ok","retry","Number","text","resContentType","test","json","createDrive","userAgent","owner","repo","global","request","shaCache","requestAPI","file","names","item","sha","content","overwrite","params","has","body","retried","includes","requestRPC","entries","entry","has_more","cursor","stringifyParams","obj","URLSearchParams","toString","mode","autorename","mute","query","files","value","FormData","Blob","fileMetaCache","lockRev","revDelete","fileId","revId","queryPatch","headRevisionId","revisions","queryList","onPage","nextPageToken","updateMeta","encodeURIComponent","filter","f","startsWith","split","parents","append","type","dirname","dir","replace","arrayify","Array","isArray","xmlToJSON","node","children","prototype","call","childNodes","nodeType","textContent","c","cResult","localName","url","DOMParser","endsWith","requestDAV","parser","xml","parseFromString","multistatus","response","r","href","propstat","some","s","prop","resourcetype","collection","base","absUrl","URL","withDir","cb"],"mappings":"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"}